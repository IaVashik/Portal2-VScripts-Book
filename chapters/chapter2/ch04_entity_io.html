<h2 class="text-3xl font-bold mb-4">Chapter 2.3: Running Code with Entity I/O</h2>
<p>Your scripts don't have to just run once. You can trigger code to run at any time using the game's built-in <strong>Input/Output (I/O)</strong> system.</p>
<p>All entities have these special VScript <strong>Inputs</strong>:</p>
<ul class="list-disc list-inside">
    <li><strong><code>CallScriptFunction</code></strong>: Looks for a function by name within the entity's script and runs it. Best for calling pre-defined functions without arguments.</li>
    <li><strong><code>RunScriptCode</code></strong>: Executes its parameter as a single line of Squirrel code. Best for simple commands or for calling functions that need arguments.</li>
</ul>
<h3 class="text-2xl font-bold mt-8 mb-4">Example</h3>
<p>Imagine a button (<code>func_button</code>) and a door (<code>prop_dynamic</code>). The door has a script attached to it called <code>door_logic.nut</code>.</p>
<p><strong><code>door_logic.nut</code>:</strong></p>
<pre><code class="language-squirrel">// Define a function inside the door's script scope.
function OpenTheDoor() {
    printl("The OpenTheDoor function was called!")
    self.SetAnimation("open") // An example of what you might do.
}

function SetMessage(text) {
    printl("The door received a message: " + text)
}
</code></pre>
<p><strong>In Hammer</strong>, you would create an output on the button's <code>OnPressed</code> event. You have two options:</p>
<ol class="list-decimal list-inside">
    <li>Target the door and use the input <code>CallScriptFunction</code> with a parameter of <code>OpenTheDoor</code>. This is clean and simple.</li>
    <li>Target the door and use the input <code>RunScriptCode</code> with a parameter of <code>SetMessage("You pressed the button!")</code>. This allows you to pass data directly into a function.</li>
</ol>
<p>When the player presses the button, the corresponding function in your script runs.</p>

<br>

<h3 class="text-2xl font-bold mt-8 mb-4">The Actors: <code>self</code>, <code>activator</code>, and <code>caller</code></h3>
<p>When code is run via the I/O system, VScript provides special variables that tell you *who* is involved in the action.</p>
<ul class="list-disc list-inside space-y-2">
    <li><strong><code>self</code></strong>: The entity whose script is currently running. In the example above, `self` is the door.</li>
    <li><strong><code>activator</code></strong>: The entity that initiated the entire chain of events. This is most often the player.</li>
    <li><strong><code>caller</code></strong>: The entity that fired the *specific input* that triggered your script.</li>
</ul>

<h4 class="text-xl font-bold mt-4 mb-2">Visualizing the Chain</h4>
<!-- START REPLACEMENT BLOCK -->

<style>
    .vscript-flow {
        --flow-border-color: #6b7280; /* dark: #9ca3af */
        --flow-bg-color: #f3f4f6; /* dark: #374151 */
        --flow-arrow-color: #4b5563; /* dark: #d1d5db */
        --flow-label-color: #4b5563; /* dark: #d1d5db */
        --flow-variable-color: #c026d3; /* dark: #f0abfc */

        display: grid;
        grid-template-columns: 1fr auto 1fr; /* Left Label | Node | Right Label */
        align-items: center;
        gap: 0 1rem;
    }
    .dark .vscript-flow {
        --flow-border-color: #9ca3af;
        --flow-bg-color: #374151;
        --flow-arrow-color: #d1d5db;
        --flow-label-color: #d1d5db;
        --flow-variable-color: #f0abfc;
    }
    .flow-node {
        grid-column: 2;
        border: 2px solid var(--flow-border-color);
        background-color: var(--flow-bg-color);
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        text-align: center;
        white-space: nowrap;
    }
    .flow-connector {
        grid-column: 1 / -1; /* Span all 3 columns */
        text-align: center;
        padding: 0.75rem 0;
        color: var(--flow-arrow-color);
        font-family: monospace;
    }
    .role-label {
        grid-column: 1;
        text-align: right;
        font-style: italic;
        font-size: 0.9em;
        color: var(--flow-label-color);
    }
    .variable-pointer {
        grid-column: 3;
        display: flex;
        align-items: center;
        min-width: 100px;
    }
    .variable-pointer .line {
        flex-grow: 1;
        border-bottom: 2px dashed var(--flow-border-color);
        height: 1px;
    }
    .variable-pointer .arrowhead {
        font-size: 1.2em;
        color: var(--flow-border-color);
        margin: 0 0.25rem;
    }
    .variable-pointer code {
        color: var(--flow-variable-color);
        font-weight: bold;
    }
    .self-context {
        grid-column: 2;
        text-align: center;
        font-style: italic;
        font-size: 0.9em;
        color: var(--flow-label-color);
        padding-top: 0.25rem;
    }
</style>

<p>Imagine this setup: A player presses a **button**. The button's output targets a **trigger**. The trigger's output targets a **door**, which has a script on it.</p>

<div class="vscript-flow not-prose my-8 p-4 border rounded-lg text-center">
    
    <!-- Player Row -->
    <div class="role-label">(The one who started it all)</div>
    <div class="flow-node">[Player]</div>
    <div class="variable-pointer">
        <div class="line"></div>
        <div class="arrowhead">◀</div>
        <code>activator</code>
    </div>

    <!-- Connector -->
    <div class="flow-connector">▼ Fires output to</div>

    <!-- Button Row -->
    <div class="role-label"></div>
    <div class="flow-node">[Button]</div>
    <div class="variable-pointer"></div>

    <!-- Connector -->
    <div class="flow-connector">▼ Fires output to</div>

    <!-- Trigger Row -->
    <div class="role-label">(The one who fired the input)</div>
    <div class="flow-node">[Trigger]</div>
    <div class="variable-pointer">
        <div class="line"></div>
        <div class="arrowhead">◀</div>
        <code>caller</code>
    </div>

    <!-- Connector -->
    <div class="flow-connector">▼ Fires output to</div>
    
    <!-- Door Row -->
    <div class="role-label">(The one executing the code)</div>
    <div class="flow-node">[Door w/ Script]</div>
    <div class="variable-pointer">
        <div class="line"></div>
        <div class="arrowhead">◀</div>
        <code>self</code>
    </div>
    <div class="self-context">(script context)</div>

</div>

<!-- END REPLACEMENT BLOCK -->
<pre><code class="language-squirrel">// Inside the door's script function
function AnalyzeSignal() {
    printl("I am the door: " + self.GetName()) // self is the door
    printl("The signal came from: " + caller.GetClassname()) // caller is the trigger
    printl("This was all started by: " + activator.GetClassname()) // activator is the player
}
</code></pre>
<p>Understanding this chain is vital for creating logic that correctly identifies who or what is interacting with your scripted entities.</p>